<Window x:Class="EtabInspector.UI.Views.ShellWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.inkore.net/lib/ui/wpf/modern"
        xmlns:xcad="clr-namespace:AvalonDock;assembly=AvalonDock"
        xmlns:xcadl="clr-namespace:AvalonDock.Layout;assembly=AvalonDock"
        xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
        xmlns:helpers="clr-namespace:EtabInspector.UI.Helpers"
        xmlns:documents="clr-namespace:EtabInspector.UI.Views.Documents"
        xmlns:toolwindows="clr-namespace:EtabInspector.UI.Views.ToolWindows"
        x:Name="ShellWindowRoot"
        WindowStartupLocation="CenterScreen"
        Title="ETABS Inspector"
        Height="900" Width="1600"
        ui:WindowHelper.UseModernWindowStyle="True">

    <Window.Resources>
        <!-- Document Templates -->
        <DataTemplate x:Key="ModelDocumentTemplate">
            <documents:ModelDocumentView />
        </DataTemplate>

        <DataTemplate x:Key="DrawingDocumentTemplate">
            <documents:DrawingDocumentView />
        </DataTemplate>

        <!-- Document Template Selector -->
        <helpers:DocumentTemplateSelector x:Key="DocumentTemplateSelector"
                                          ModelDocumentTemplate="{StaticResource ModelDocumentTemplate}"
                                          DrawingDocumentTemplate="{StaticResource DrawingDocumentTemplate}"/>
    </Window.Resources>

    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Loaded">
            <i:InvokeCommandAction Command="{Binding LoadedCommand}" />
        </i:EventTrigger>
    </i:Interaction.Triggers>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Menu Bar -->
        <Menu Grid.Row="0" Padding="8,4">
            <MenuItem Header="_File">
                <MenuItem Header="New _Model" Command="{Binding NewModelCommand}" InputGestureText="Ctrl+N">
                    <MenuItem.Icon>
                        <ui:FontIcon Glyph="&#xE8F1;" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="New _Drawing" Command="{Binding NewDrawingCommand}" InputGestureText="Ctrl+D">
                    <MenuItem.Icon>
                        <ui:FontIcon Glyph="&#xE70F;" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="_Close Document" Command="{Binding CloseDocumentCommand}" InputGestureText="Ctrl+W"/>
                <MenuItem Header="Close _All Documents" Command="{Binding CloseAllDocumentsCommand}"/>
                <Separator/>
                <MenuItem Header="_Settings" Command="{Binding OpenSettingsCommand}">
                    <MenuItem.Icon>
                        <ui:FontIcon Glyph="&#xE713;" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="E_xit" Command="{Binding ExitCommand}" InputGestureText="Alt+F4"/>
            </MenuItem>
            <MenuItem Header="_View">
                <MenuItem Header="_Explorer" Command="{Binding ToggleExplorerCommand}" 
                          IsCheckable="True" IsChecked="{Binding Explorer.IsVisible}">
                    <MenuItem.Icon>
                        <ui:FontIcon Glyph="&#xE8B7;" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="_Properties" Command="{Binding TogglePropertiesCommand}"
                          IsCheckable="True" IsChecked="{Binding Properties.IsVisible}">
                    <MenuItem.Icon>
                        <ui:FontIcon Glyph="&#xE8BC;" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="_Output" Command="{Binding ToggleOutputCommand}"
                          IsCheckable="True" IsChecked="{Binding Output.IsVisible}">
                    <MenuItem.Icon>
                        <ui:FontIcon Glyph="&#xE756;" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="_Zoom In" InputGestureText="Ctrl++"/>
                <MenuItem Header="Zoom _Out" InputGestureText="Ctrl+-"/>
                <MenuItem Header="_Fit to Window" InputGestureText="Ctrl+0"/>
            </MenuItem>
            <MenuItem Header="_Tools">
                <MenuItem Header="_Options"/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_Documentation"/>
                <MenuItem Header="_About"/>
            </MenuItem>
        </Menu>

        <!-- Toolbar -->
        <Border Grid.Row="1" 
                BorderBrush="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                BorderThickness="0,1"
                Padding="8">
            <StackPanel Orientation="Horizontal">
                <Button Command="{Binding NewModelCommand}" 
                           Style="{StaticResource AccentButtonStyle}"
                           Padding="12,6" Margin="0,0,4,0">
                    <StackPanel Orientation="Horizontal">
                        <ui:FontIcon Glyph="&#xE8F1;" FontSize="14" Margin="0,0,6,0"/>
                        <TextBlock Text="New Model"/>
                    </StackPanel>
                </Button>
                <Button Command="{Binding NewDrawingCommand}" 
                           Style="{StaticResource AccentButtonStyle}"
                           Padding="12,6" Margin="0,0,4,0">
                    <StackPanel Orientation="Horizontal">
                        <ui:FontIcon Glyph="&#xE70F;" FontSize="14" Margin="0,0,6,0"/>
                        <TextBlock Text="New Drawing"/>
                    </StackPanel>
                </Button>
                <Border Width="1" Margin="8,4" 
                        Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"/>
                <Button Command="{Binding CloseDocumentCommand}" 
                           Padding="12,6" Margin="0,0,4,0">
                    <StackPanel Orientation="Horizontal">
                        <ui:FontIcon Glyph="&#xE711;" FontSize="14" Margin="0,0,6,0"/>
                        <TextBlock Text="Close"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Border>

        <!-- Main Content - AvalonDock -->
        <Grid Grid.Row="2">
            <xcad:DockingManager x:Name="dockManager"
                                 DocumentsSource="{Binding Documents}"
                                 ActiveContent="{Binding ActiveDocument, Mode=TwoWay}"
                                 LayoutItemTemplateSelector="{StaticResource DocumentTemplateSelector}">

                <!-- Document Header Template -->
                <xcad:DockingManager.DocumentHeaderTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding Title}" 
                                       Margin="8,0" 
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </DataTemplate>
                </xcad:DockingManager.DocumentHeaderTemplate>

                <!-- Layout Root -->
                <xcadl:LayoutRoot>
                    <xcadl:LayoutPanel Orientation="Horizontal">

                        <!-- Left Side - Explorer Tool Window -->
                        <xcadl:LayoutAnchorablePaneGroup DockWidth="280" Orientation="Vertical">
                            <xcadl:LayoutAnchorablePane>
                                <xcadl:LayoutAnchorable Title="{Binding Explorer.Title}"
                                                       ContentId="{Binding Explorer.ContentId}"
                                                       CanClose="False"
                                                       CanHide="True"
                                                       helpers:LayoutAnchorableBehavior.IsVisibleBinding="{Binding Explorer.IsVisible, Mode=TwoWay}">
                                    <toolwindows:ExplorerView DataContext="{Binding Explorer}"/>
                                </xcadl:LayoutAnchorable>
                            </xcadl:LayoutAnchorablePane>
                        </xcadl:LayoutAnchorablePaneGroup>

                        <!-- Center - Document Area -->
                        <xcadl:LayoutPanel Orientation="Vertical" DockWidth="*">
                            <xcadl:LayoutDocumentPaneGroup>
                                <xcadl:LayoutDocumentPane/>
                            </xcadl:LayoutDocumentPaneGroup>

                            <!-- Bottom - Output Tool Window -->
                            <xcadl:LayoutAnchorablePaneGroup DockHeight="180">
                                <xcadl:LayoutAnchorablePane>
                                    <xcadl:LayoutAnchorable Title="{Binding Output.Title}"
                                                           ContentId="{Binding Output.ContentId}"
                                                           CanClose="False"
                                                           CanHide="True"
                                                           helpers:LayoutAnchorableBehavior.IsVisibleBinding="{Binding Output.IsVisible, Mode=TwoWay}">
                                        <toolwindows:OutputView DataContext="{Binding Output}"/>
                                    </xcadl:LayoutAnchorable>
                                </xcadl:LayoutAnchorablePane>
                            </xcadl:LayoutAnchorablePaneGroup>
                        </xcadl:LayoutPanel>

                        <!-- Right Side - Properties Tool Window -->
                        <xcadl:LayoutAnchorablePaneGroup DockWidth="320" Orientation="Vertical">
                            <xcadl:LayoutAnchorablePane>
                                <xcadl:LayoutAnchorable Title="{Binding Properties.Title}"
                                                       ContentId="{Binding Properties.ContentId}"
                                                       CanClose="False"
                                                       CanHide="True"
                                                       helpers:LayoutAnchorableBehavior.IsVisibleBinding="{Binding Properties.IsVisible, Mode=TwoWay}">
                                    <toolwindows:PropertiesView DataContext="{Binding Properties}"/>
                                </xcadl:LayoutAnchorable>
                            </xcadl:LayoutAnchorablePane>
                        </xcadl:LayoutAnchorablePaneGroup>

                    </xcadl:LayoutPanel>
                </xcadl:LayoutRoot>
            </xcad:DockingManager>

            <!-- Welcome Screen Overlay -->
            <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}" 
                    Visibility="{Binding Documents.Count, Converter={StaticResource CountToVisibilityConverter}}">
                <Grid>
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                        <ui:FontIcon Glyph="&#xE8F1;" 
                                     FontSize="120" 
                                     Foreground="{DynamicResource SystemControlForegroundAccentBrush}"/>
                        <TextBlock Text="ETABS Inspector" 
                                   FontSize="32" 
                                   FontWeight="SemiBold"
                                   HorizontalAlignment="Center" 
                                   Margin="0,24,0,12"/>
                        <TextBlock Text="Create a new document to get started" 
                                   FontSize="16" 
                                   HorizontalAlignment="Center" 
                                   Margin="0,0,0,40"
                                   Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                            <Button Command="{Binding NewModelCommand}" 
                                       Style="{StaticResource AccentButtonStyle}"
                                       Padding="24,16" Margin="8,0">
                                <StackPanel>
                                    <ui:FontIcon Glyph="&#xE8F1;" FontSize="48" HorizontalAlignment="Center"/>
                                    <TextBlock Text="New Model" FontSize="14" Margin="0,12,0,0" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <Button Command="{Binding NewDrawingCommand}" 
                                       Style="{StaticResource AccentButtonStyle}"
                                       Padding="24,16" Margin="8,0">
                                <StackPanel>
                                    <ui:FontIcon Glyph="&#xE70F;" FontSize="48" HorizontalAlignment="Center"/>
                                    <TextBlock Text="New Drawing" FontSize="14" Margin="0,12,0,0" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <StatusBar Grid.Row="3" Padding="8,4">
            <StatusBarItem>
                <StackPanel Orientation="Horizontal" Margin="0,0,8,0">
                    <ui:FontIcon Glyph="&#xE73E;" FontSize="13" Margin="0,0,6,0"/>
                    <TextBlock Text="Ready" FontWeight="SemiBold"/>
                </StackPanel>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <StackPanel Orientation="Horizontal" Margin="8,0">
                    <TextBlock Text="Active:" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding ActiveDocument.Title, FallbackValue='None'}" Margin="6,0,0,0"/>
                </StackPanel>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem HorizontalAlignment="Right">
                <StackPanel Orientation="Horizontal" Margin="8,0">
                    <TextBlock Text="Documents:" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding Documents.Count}" Margin="6,0,0,0"/>
                </StackPanel>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>